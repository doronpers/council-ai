<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Council AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <meta name="description" content="AI-powered advisory council system." />
  <meta name="theme-color" content="#f4f4f4" />
  <link rel="manifest" href="/manifest.json" />

  <!-- Preconnect to fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
  <header>
    <h1>Council AI</h1>
    <p>Intelligent Advisory System</p>
    <nav class="nav">
      <a href="/" class="nav-link nav-link--active">üèõÔ∏è Council Consultation</a>
      <a href="/reviewer" class="nav-link">‚öñÔ∏è LLM Response Reviewer</a>
    </nav>
  </header>

  <main>
    <section class="panel">
      <h2>Configuration</h2>

      <div class="grid essential-settings">
        <div>
          <label for="domain">Domain</label>
          <select id="domain"></select>
          <p class="hint">Pre-configured council for your topic (General includes all 7 members)</p>
        </div>
        <div>
          <label for="mode">Consultation Mode</label>
          <select id="mode"></select>
          <p class="hint">How the council responds (synthesis recommended)</p>
        </div>
      </div>

      <!-- Member Preview Section -->
      <div id="member-preview" class="member-preview" style="margin-top: 24px;">
        <h3 style="margin-bottom: 16px; font-size: 1rem; font-weight: 600;">Selected Council Members</h3>
        <div id="member-cards" class="member-cards-grid"></div>
        <p class="hint" id="member-count" style="margin-top: 12px;">0 members selected</p>
      </div>

      <details class="advanced-settings">
        <summary>Advanced Settings</summary>
        <form id="settings-form" onsubmit="return false;">
          <div class="grid">
            <div>
              <label for="provider">AI Provider</label>
              <select id="provider"></select>
            </div>
            <div>
              <label for="model">Model</label>
              <select id="model">
                <option value="">Default model</option>
              </select>
            </div>
            <div>
              <label for="temperature">Creativity (Temperature)</label>
              <div class="slider-container">
                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" />
                <output id="temperature-value">0.7</output>
              </div>
            </div>
            <div>
              <label for="max_tokens">Response Length</label>
              <select id="max_tokens">
                <option value="500">Short</option>
                <option value="1000" selected>Medium</option>
                <option value="2000">Long</option>
                <option value="4000">Extensive</option>
              </select>
            </div>
            <div>
              <label for="members">Custom Members (IDs)</label>
              <input id="members" placeholder="e.g., rams, kahneman" />
            </div>
            <div>
              <label for="api_key">API Key</label>
              <input id="api_key" placeholder="Uses environment variable if empty" type="password" />
            </div>
          </div>

          <!-- TTS Settings -->
          <div class="tts-settings">
            <h3>Voice Output</h3>
            <div class="tts-toggle-wrapper">
              <label class="switch-label">
                <input type="checkbox" id="enable_tts" />
                <span class="switch-slider"></span>
                <span class="switch-text">Enable voice synthesis</span>
              </label>
            </div>

            <div id="tts-options" class="tts-options" style="display: none;">
              <div>
                <label for="tts_voice">Voice Persona</label>
                <select id="tts_voice">
                  <option value="">Default voice</option>
                </select>
              </div>
            </div>
          </div>

          <div class="settings-actions">
            <button id="save-settings" class="btn-secondary" type="button">Save Settings</button>
            <button id="reset-settings" class="btn-secondary" type="button">Reset</button>
          </div>
        </form>
      </details>

      <label for="query">Question</label>
      <textarea id="query" placeholder="Ask for advice, strategy, or critique..."></textarea>

      <label for="context">Context (Optional)</label>
      <textarea id="context" placeholder="Background info, constraints, or specific details..."></textarea>

      <div class="button-group">
        <button id="submit">Consult Council</button>
        <button id="cancel" class="btn-secondary" style="display: none;">Cancel</button>
      </div>
    </section>

    <!-- History panel -->
    <details class="panel history-panel">
      <summary>
        <h2>History</h2>
      </summary>
      <div id="history-list" class="history-list">
        <p class="muted">Loading...</p>
      </div>
    </details>

    <section class="panel">
      <h2>Advice</h2>
      <div id="status" class="empty-state">
        <p>Ready to consult.</p>
        <p class="hint">Ask a question above and the council will deliberate.</p>
      </div>

      <div id="loading-skeleton" style="display: none;">
        <div class="skeleton skeleton-card"></div>
        <div class="skeleton skeleton-card"></div>
        <div class="progress-indicator">
          <span class="loading"></span>
          <span id="progress-text">Assembling council...</span>
        </div>
      </div>

      <!-- Progress Dashboard -->
      <div id="progress-dashboard" class="progress-dashboard" style="display: none;">
        <h3 style="margin-bottom: 16px; font-size: 1rem; font-weight: 600;">Consultation Progress</h3>
        <div id="member-status-list" class="member-status-list"></div>
        <div class="progress-bar-container" style="margin-top: 16px;">
          <div id="progress-bar" class="progress-bar"></div>
        </div>
        <p id="progress-summary" class="progress-summary" style="margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary);"></p>
      </div>

      <div id="synthesis-audio-player" class="audio-player" style="display: none;">
        <audio id="synthesis-audio" controls></audio>
      </div>

      <div id="synthesis"></div>
      <div id="responses-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3 style="margin: 0; font-size: 1rem; font-weight: 600;">Member Responses</h3>
          <button id="toggle-comparison" class="btn-secondary" style="font-size: 0.85rem; padding: 6px 12px;">
            üìä Compare Responses
          </button>
        </div>
        <div id="responses" class="responses"></div>
      </div>
    </section>
  </main>

  <script>
    // Response action functions
    function copyResponse(personaId) {
      const responseCard = document.getElementById(`response-${personaId}`);
      if (!responseCard) return;
      
      const contentEl = responseCard.querySelector('.streaming-content, .response-content-wrapper p');
      if (!contentEl) return;
      
      const text = contentEl.textContent || contentEl.innerText;
      navigator.clipboard.writeText(text).then(() => {
        // Show feedback
        const btn = responseCard.querySelector(`button[onclick*="copyResponse('${personaId}')"]`);
        if (btn) {
          const original = btn.textContent;
          btn.textContent = '‚úì';
          setTimeout(() => { btn.textContent = original; }, 2000);
        }
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }

    function toggleResponseDetails(personaId) {
      const detailsEl = document.getElementById(`response-details-${personaId}`);
      if (!detailsEl) return;
      
      const isHidden = detailsEl.style.display === 'none';
      detailsEl.style.display = isHidden ? 'block' : 'none';
      
      const btn = document.querySelector(`button[onclick*="toggleResponseDetails('${personaId}')"]`);
      if (btn) {
        btn.textContent = isHidden ? '‚ÑπÔ∏è' : '‚ÑπÔ∏è';
      }
    }
  </script>

  <script type="module" src="/assets/js/main.js"></script>
</body>

</html>